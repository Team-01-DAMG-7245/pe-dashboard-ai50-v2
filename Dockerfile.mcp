FROM python:3.11-slim

WORKDIR /app

# Upgrade pip first
RUN pip install --upgrade pip

# Install minimal requirements first (fast, essential dependencies)
COPY requirements-mcp.txt .
RUN pip install --no-cache-dir --retries 3 --timeout 100 -r requirements-mcp.txt

# Optionally install heavy RAG dependencies (uncomment if needed for RAG features)
# These can take 5-10 minutes to download/compile
# RUN pip install --no-cache-dir chromadb>=0.4.22 sentence-transformers>=2.3.1 || echo "Warning: RAG dependencies not installed"

# Copy application code
COPY src/ ./src/
COPY data/ ./data/
COPY mcp_config.json .
COPY .env .

# Expose MCP server port
EXPOSE 9000

# Run MCP server
CMD ["python", "src/lab14/server/mcp_server.py"]
